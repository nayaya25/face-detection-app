{"ast":null,"code":"var fetch = require('node-fetch');\n\nvar fs = require('fs');\n\nvar FormData = require('form-data');\n\nvar version = require('./package.json').version;\n\nfunction makeClient(api_user, api_secret) {\n  var client = {};\n  var endpoint = 'https://api.sightengine.com/';\n  var apiUser = api_user;\n  var apiSecret = api_secret;\n  var _models = [];\n\n  client.check = function (models) {\n    _models = models;\n    return client;\n  };\n\n  client.set_url = function (imageUrl) {\n    var data = {\n      'models': _models.join(),\n      'url': imageUrl,\n      'api_user': apiUser,\n      'api_secret': apiSecret\n    };\n    var querystring = encodeQueryData(data);\n    var url = endpoint + '1.0/check.json';\n    return fetch(url + '?' + querystring, {\n      headers: {\n        'user-agent': 'SE-SDK-NODEJS' + version\n      }\n    }).then(function (res) {\n      return res.json();\n    }).catch(function (error) {\n      return error;\n    });\n  };\n\n  client.set_file = function (file) {\n    var form = new FormData();\n    var url = endpoint + '1.0/check.json';\n    form.append('api_user', apiUser);\n    form.append('api_secret', apiSecret);\n    form.append('models', _models.join());\n    form.append('media', fs.createReadStream(file));\n    return fetch(url, {\n      method: 'POST',\n      body: form,\n      headers: {\n        'user-agent': 'SE-SDK-NODEJS' + version\n      }\n    }).then(function (res) {\n      return res.json();\n    }).catch(function (error) {\n      return error;\n    });\n  };\n\n  client.set_bytes = function (binaryImage, filename) {\n    var form = new FormData();\n    var url = endpoint + '1.0/check.json';\n    form.append('api_user', apiUser);\n    form.append('api_secret', apiSecret);\n    form.append('models', _models.join());\n    form.append('media', binaryImage, {\n      filename: filename\n    });\n    return fetch(url, {\n      method: 'POST',\n      body: form,\n      headers: {\n        'user-agent': 'SE-SDK-NODEJS' + version\n      }\n    }).then(function (res) {\n      return res.json();\n    }).catch(function (error) {\n      return error;\n    });\n  };\n\n  client.video = function (video, callback) {\n    var url = endpoint + '/1.0/video/check.json';\n    var data = {\n      'stream_url': video,\n      'models': _models.join(),\n      'callback_url': callback,\n      'api_user': apiUser,\n      'api_secret': apiSecret\n    };\n    var querystring = encodeQueryData(data);\n    return fetch(url + '?' + querystring, {\n      headers: {\n        'user-agent': 'SE-SDK-NODEJS' + version\n      }\n    }).then(function (res) {\n      return res.json();\n    }).catch(function (error) {\n      return error;\n    });\n  };\n\n  client.video_sync = function (video) {\n    var url = endpoint + '/1.0/video/check-sync.json';\n    var data = {\n      'stream_url': video,\n      'models': _models.join(),\n      'api_user': apiUser,\n      'api_secret': apiSecret\n    };\n    var querystring = encodeQueryData(data);\n    return fetch(url + '?' + querystring, {\n      headers: {\n        'user-agent': 'SE-SDK-NODEJS' + version\n      }\n    }).then(function (res) {\n      return res.json();\n    }).catch(function (error) {\n      return error;\n    });\n  };\n\n  client.feedback = function (model, modelClass, image) {\n    var url = endpoint + '1.0/feedback.json';\n\n    if (image.indexOf(\"http://\") == 0 || image.indexOf(\"https://\") == 0) {\n      var data = {\n        'model': model,\n        'class': modelClass,\n        'url': image,\n        'api_user': apiUser,\n        'api_secret': apiSecret\n      };\n      var querystring = encodeQueryData(data);\n      return fetch(url + '?' + querystring, {\n        headers: {\n          'user-agent': 'SE-SDK-NODEJS' + version\n        }\n      }).then(function (res) {\n        return res.json();\n      }).catch(function (error) {\n        return error;\n      });\n    } else {\n      var form = new FormData();\n      form.append('api_user', apiUser);\n      form.append('api_secret', apiSecret);\n      form.append('class', modelClass);\n      form.append('model', model);\n      form.append('media', fs.createReadStream(image));\n      return fetch(url, {\n        method: 'POST',\n        body: form,\n        headers: {\n          'user-agent': 'SE-SDK-NODEJS' + version\n        }\n      }).then(function (res) {\n        return res.json();\n      }).catch(function (error) {\n        return error;\n      });\n    }\n\n    ;\n  };\n\n  return client;\n}\n\nfunction encodeQueryData(data) {\n  var ret = [];\n\n  for (var d in data) {\n    ret.push(encodeURIComponent(d) + '=' + encodeURIComponent(data[d]));\n  }\n\n  return ret.join('&');\n}\n\nmodule.exports = makeClient;","map":null,"metadata":{},"sourceType":"script"}